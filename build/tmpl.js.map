{"version":3,"sources":["../lib/tmpl.js"],"names":[],"mappings":"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","file":"tmpl.js","sourcesContent":["const global = window;\n\nconst support = {\n  localStorage: 'localStorage' in global,\n};\n\nconst getCache = (name, version) => {\n  let result = {\n    name: name,\n    version: version,\n    code: '',\n  };\n\n  try {\n    const str = global.localStorage.getItem(name);\n    if (str) {\n      let obj = JSON.parse(str);\n      if (obj.version === version) result = obj;\n    }\n  } catch (err) {\n    console.error(err);\n  }\n\n  return result;\n};\n\nconst setCache = opts => {\n  try {\n    global.localStorage.setItem(opts.name, JSON.stringify(opts));\n  } catch (err) {\n    console.error(err);\n  }\n};\n\nconst encode = s => String(s).replace(/&/g, '&amp;')\n                              .replace(/</g, '&lt;')\n                              .replace(/>/g, '&gt;')\n                              .replace(/ /g, '&nbsp;')\n                              .replace(/\\'/g, '&#39;')\n                              .replace(/\\\"/g, '&quot;')\n                              .replace(/\\n/g, '<br>');\n\nconst decode = s => String(s).replace(/&amp;/g, '&')\n                              .replace(/&lt;/g, '<')\n                              .replace(/&gt;/g, '>')\n                              .replace(/&nbsp;/g, ' ')\n                              .replace(/&#39;/g, '\\'')\n                              .replace(/&quot;/g, '\"')\n                              .replace(/<br>/g, '\\n');\n\nconst defaultParseOpts = { cache: true, name: '', version: '0', };\n\nconst parse = (tpl = '', data = {}, opts = defaultParseOpts) => {\n  let reg = /\\<\\#([\\s\\S]+?)\\#\\>/g,\n      code = '',\n      cursor = 0,\n      result,\n      match,\n      cacheCode = '',\n      cacheObj = {};\n\n  const isCache = support.localStorage && opts.cache && opts.name;\n\n  if (isCache) {\n    cacheObj = getCache(opts.name, opts.version);\n    if (cacheObj.code) cacheCode = cacheObj.code;\n  }\n\n  if (!cacheCode) {\n    const push = (line, js) => {\n      if (!line) return push;\n      if (js) {\n        let _s = line.charAt(0);\n\n        switch (_s) {\n          case '=':\n            code += `\n              __r__.push(encode(${line.substr(1)}));\n            `;\n            break;\n          case '-':\n            code += `\n              __r__.push(${line.substr(1)});\n            `;\n            break;\n          default:\n            code += line;\n            break;\n        }\n      } else {\n        code += `\n          __r__.push(\"${line.replace(/\"/g, '\\\\\"')}\");\n        `;\n      }\n\n      return push;\n    };\n\n    while (match = reg.exec(tpl)) {\n      push(tpl.slice(cursor, match.index))(match[1], true);\n      cursor = match.index + match[0].length;\n    }\n\n    push(tpl.substr(cursor, tpl.length - cursor));\n    code = (`with(obj) {\n              var __r__ = [];\n              ${code}\n              return __r__.join(\"\");\n            }`).replace(/[\\r\\t\\n]/g, '');\n\n    if (isCache)\n      setCache({ name: opts.name, version: opts.version, code: code, });\n  } else {\n    code = cacheCode;\n  }\n\n  try {\n    result = new Function('obj', 'encode', code).apply(data, [data, encode]);\n  } catch (e) {\n    console.error('\\'' + e.message + '\\'', 'in \\n\\n Code: \\n', code, '\\n');\n  }\n\n  return result;\n};\n\nexport default {\n  parse,\n  decode,\n  encode,\n};\n"]}