(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.Tmpl=factory()})(this,function(){"use strict";var tmpl={};tmpl.encode=function(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>")};tmpl.decode=function(s){return String(s).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/<br>/g,"\n")};var opts={delimiter:"%"};tmpl.set=function(key,val){opts[key]=val};tmpl.compile=function(tpl){if(tpl===void 0)tpl="";var reg=new RegExp("\\<\\"+opts.delimiter+"([\\s\\S]+?)\\"+opts.delimiter+"\\>","g");var cursor=0;var code="";var match;var push=function(line,js){if(!line){return push}if(js){var _s=line.charAt(0);switch(_s){case"=":code+="\n            __r__.push(encode("+line.substr(1)+"));\n          ";break;case"-":code+="\n            __r__.push("+line.substr(1)+");\n          ";break;default:code+=line;break}}else{code+='\n        __r__.push("'+line.replace(/"/g,'\\"')+'");\n      '}return push};while(match=reg.exec(tpl)){push(tpl.slice(cursor,match.index))(match[1],true);cursor=match.index+match[0].length}push(tpl.substr(cursor,tpl.length-cursor));code=("with(obj) {\n            var __r__ = [];\n            "+code+'\n            return __r__.join("");\n          }').replace(/[\r\t\n]/g,"");return function(data){if(data===void 0)data={};return new Function("obj, encode",code).apply(data,[data,tmpl.encode])}};tmpl.parse=function(tpl,data){if(tpl===void 0)tpl="";if(data===void 0)data={};return tmpl.compile(tpl)(data)};return tmpl});